services:
  # ------------------------------------
  # 1. User Authentication (Web Service - Free)
  # ------------------------------------
  - type: web
    name: user-authentication
    env: docker
    plan: free
    dockerfilePath: ./microservices/user-authentication/Dockerfile
    dockerContext: ./microservices/user-authentication
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3004
      - key: DATABASE_URL
        sync: false
      - key: JWT_SECRET
        generateValue: true

  # ------------------------------------
  # 2. User Preferences (Web Service - Free)
  # ------------------------------------
  - type: web
    name: user-preferences
    env: docker
    plan: free
    dockerfilePath: ./microservices/user-preferences/Dockerfile
    dockerContext: ./microservices/user-preferences
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: DATABASE_URL
        sync: false

  # ------------------------------------
  # 3. Custom Redis (Web Service - Free)
  # ASTUCE : On le fait passer pour un site web pour l'avoir gratuit
  # ------------------------------------
  - type: web
    name: content-cache
    env: docker
    plan: free
    dockerfilePath: ./microservices/redis/Dockerfile
    dockerContext: ./microservices/redis
    envVars:
      - key: PORT
        value: 6379

  # ------------------------------------
  # 4. Content Feed (Web Service - Free)
  # ------------------------------------
  - type: web
    name: content-feed
    env: docker
    plan: free
    dockerfilePath: ./microservices/content-feed/Dockerfile
    dockerContext: ./microservices/content-feed
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3002
      # On pointe vers notre nouveau service Redis "hacké"
      - key: REDIS_URL
        value: redis://content-cache:6379
      - key: REDIS_HOST
        value: content-cache
      - key: REDIS_PORT
        value: 6379
      - key: GNEWS_API_KEY
        sync: false
      - key: AFRICA_NEWS_API_KEY
        sync: false

  # ------------------------------------
  # 5. Content Recommendation (Web Service - Free)
  # ------------------------------------
  - type: web
    name: content-recommendation
    env: docker
    plan: free
    dockerfilePath: ./microservices/content-recommendation/Dockerfile
    dockerContext: ./microservices/content-recommendation
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3003
      - key: DATABASE_URL
        sync: false

  # ------------------------------------
  # 6. Content Categories (Web Service - Free)
  # ------------------------------------
  - type: web
    name: content-categories
    env: docker
    plan: free
    dockerfilePath: ./microservices/content-categories/Dockerfile
    dockerContext: ./microservices/content-categories
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3005
      - key: DATABASE_URL
        sync: false

  # ------------------------------------
  # 7. API Gateway (Web Service - Free)
  # ------------------------------------
  - type: web
    name: api-gateway
    env: docker
    plan: free 
    dockerfilePath: ./microservices/api-gateway/Dockerfile
    dockerContext: ./microservices/api-gateway
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      # URLs des services - Utiliser les URLs publiques Render
      # Remplace ces valeurs par les vraies URLs publiques de tes services sur Render
      - key: AUTH_SERVICE_URL
        sync: false  # À configurer manuellement dans Render avec l'URL publique
      - key: PREFERENCES_SERVICE_URL
        sync: false  # À configurer manuellement dans Render avec l'URL publique
      - key: FEED_SERVICE_URL
        sync: false  # À configurer manuellement dans Render avec l'URL publique
      - key: RECOMMENDATION_SERVICE_URL
        sync: false  # À configurer manuellement dans Render avec l'URL publique
      - key: CATEGORIES_SERVICE_URL
        sync: false  # À configurer manuellement dans Render avec l'URL publique
